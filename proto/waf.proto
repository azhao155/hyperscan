syntax = "proto3";

package wafservice;

service WafService {
  rpc EvalRequest (stream WafHttpRequest) returns (WafDecision) {}
  rpc PutConfig (WAFConfig) returns (PutConfigResponse) {}
}

message HeaderPair {
   string key = 1;
   string value = 2;
}

message WafHttpRequest {
    oneof content {
        HeadersAndFirstChunk headersAndFirstChunk = 1;
        NextBodyChunk nextBodyChunk = 2;
    }
}

message HeadersAndFirstChunk {
  string method = 1;
  string uri = 2;
  repeated HeaderPair headers = 3;
  bytes firstBodyChunk = 4;
  bool moreBodyChunks = 5;
}

message NextBodyChunk {
  bytes bodyChunk = 1;
  bool moreBodyChunks = 2;
}


message WafDecision {
  bool allow = 1;
}

message WAFConfig {
  repeated SecRuleConfig secRuleConfigs = 1;
  repeated GeoDBConfig geoDBConfigs = 2;
  repeated IPReputationConfig ipReputationConfigs = 3;
}

message SecRuleConfig { 
  string id = 1;
  bool enabled = 2; 
}

message GeoDBConfig { 
  string id = 1;
  bool enabled = 2; 
}

message IPReputationConfig { 
  string id = 1;
  bool enabled = 2; 
}

message PutConfigResponse { 
  int64 version = 1;
}
